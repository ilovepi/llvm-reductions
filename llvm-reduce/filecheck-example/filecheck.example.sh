#!/bin/bash
# Crash reproducer for Fuchsia clang version 16.0.0 (https://llvm.googlesource.com/llvm-project f85c1f3b7c0bda64aef12201e2f5bbad6028582d)
# Driver args: "--target=x86_64-fuchsia" "-Wall" "-Werror" "-Wextra-semi" "-Wnewline-eof" "-fdiagnostics-color" "-std=c++17" "-x" "c++" "-fPIC" "-MD" "-MF" "bazel-out/x86_64-fastbuild/bin/src/qemu_edu/drivers/_objs/qemu_edu/edu_device.pic.d" "-frandom-seed=bazel-out/x86_64-fastbuild/bin/src/qemu_edu/drivers/_objs/qemu_edu/edu_device.pic.o" "-fPIC" "-iquote" "." "-iquote" "bazel-out/x86_64-fastbuild/bin" "-iquote" "external/fuchsia_sdk" "-iquote" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk" "-iquote" "external/bazel_tools" "-iquote" "bazel-out/x86_64-fastbuild/bin/external/bazel_tools" "-I" "bazel-out/x86_64-fastbuild/bin/src/qemu_edu/fidl/_virtual_includes/fuchsia.examples.qemuedu_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/zx/_virtual_includes/zx_llcpp_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/fidl_cpp_wire/_virtual_includes/fidl_cpp_wire" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/async/_virtual_includes/async" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/fit/_virtual_includes/fit" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/stdcompat/_virtual_includes/stdcompat" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/fit-promise/_virtual_includes/fit-promise" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/async-cpp/_virtual_includes/async-cpp" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/zx/_virtual_includes/zx" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/fidl/_virtual_includes/fidl" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/fidl_base/_virtual_includes/fidl_base" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/utf-utils/_virtual_includes/utf-utils" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/sync/_virtual_includes/sync" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/zxc/_virtual_includes/zxc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/fidl_cpp_v2/_virtual_includes/fidl_cpp_v2" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/fidl_cpp_base_v2/_virtual_includes/fidl_cpp_base_v2" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.device.fs/_virtual_includes/fuchsia.device.fs_llcpp_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.io/_virtual_includes/fuchsia.io_llcpp_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.unknown/_virtual_includes/fuchsia.unknown_llcpp_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.driver.compat/_virtual_includes/fuchsia.driver.compat_llcpp_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.hardware.pci/_virtual_includes/fuchsia.hardware.pci_llcpp_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/zx/_virtual_includes/zx_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/fidl_cpp/_virtual_includes/fidl_cpp" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/async-default/_virtual_includes/async-default" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/fidl_cpp_sync/_virtual_includes/fidl_cpp_sync" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/fidl_cpp_base/_virtual_includes/fidl_cpp_base" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/driver2_cpp/_virtual_includes/driver2_cpp" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/driver2-record/_virtual_includes/driver2-record" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/driver_runtime/_virtual_includes/driver_runtime" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/driver_runtime_cpp/_virtual_includes/driver_runtime_cpp" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/fdio/_virtual_includes/fdio" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/fidl_driver_transport/_virtual_includes/fidl_driver_transport" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/sys_component_cpp/_virtual_includes/sys_component_cpp" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/svc/_virtual_includes/svc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/trace-engine/_virtual_includes/trace-engine" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.io/_virtual_includes/fuchsia.io_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.unknown/_virtual_includes/fuchsia.unknown_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/syslog_structured_backend/_virtual_includes/syslog_structured_backend" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.component.decl/_virtual_includes/fuchsia.component.decl_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.data/_virtual_includes/fuchsia.data_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.url/_virtual_includes/fuchsia.url_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.driver.framework/_virtual_includes/fuchsia.driver.framework_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.component/_virtual_includes/fuchsia.component_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.process/_virtual_includes/fuchsia.process_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.ldsvc/_virtual_includes/fuchsia.ldsvc_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.component.runner/_virtual_includes/fuchsia.component.runner_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.diagnostics.types/_virtual_includes/fuchsia.diagnostics.types_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.mem/_virtual_includes/fuchsia.mem_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.logger/_virtual_includes/fuchsia.logger_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.diagnostics/_virtual_includes/fuchsia.diagnostics_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.component.decl/_virtual_includes/fuchsia.component.decl_llcpp_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.data/_virtual_includes/fuchsia.data_llcpp_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.url/_virtual_includes/fuchsia.url_llcpp_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.driver.framework/_virtual_includes/fuchsia.driver.framework_llcpp_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.component/_virtual_includes/fuchsia.component_llcpp_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.process/_virtual_includes/fuchsia.process_llcpp_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.ldsvc/_virtual_includes/fuchsia.ldsvc_llcpp_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.component.runner/_virtual_includes/fuchsia.component.runner_llcpp_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.diagnostics.types/_virtual_includes/fuchsia.diagnostics.types_llcpp_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.mem/_virtual_includes/fuchsia.mem_llcpp_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.logger/_virtual_includes/fuchsia.logger_llcpp_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.diagnostics/_virtual_includes/fuchsia.diagnostics_llcpp_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/hwreg/_virtual_includes/hwreg" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/mmio/_virtual_includes/mmio" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/mmio-ptr/_virtual_includes/mmio-ptr" "--debug" "--sysroot=external/fuchsia_clang/fuchsia_sysroot_x86_64" "-c" "src/qemu_edu/drivers/edu_device.cc" "-o" "bazel-out/x86_64-fastbuild/bin/src/qemu_edu/drivers/_objs/qemu_edu/edu_device.pic.o" "-gen-reproducer"
# Original command:  "/usr/local/google/home/dangyi/.cache/bazel/_bazel_dangyi/f2b9e39c6dd3dfd4d600a38e6ff65cce/external/fuchsia_clang/bin/clang-16" "-cc1" "-triple" "x86_64-unknown-fuchsia" "-emit-obj" "-mrelax-all" "--mrelax-relocations" "-disable-free" "-clear-ast-before-backend" "-disable-llvm-verifier" "-discard-value-names" "-main-file-name" "edu_device.cc" "-mrelocation-model" "pic" "-pic-level" "2" "-fhalf-no-semantic-interposition" "-mframe-pointer=all" "-ffp-contract=on" "-fno-rounding-math" "-mconstructor-aliases" "-funwind-tables=2" "-target-cpu" "x86-64" "-tune-cpu" "generic" "-mllvm" "-treat-scalable-fixed-error-as-warning" "-debug-info-kind=constructor" "-dwarf-version=5" "-debugger-tuning=gdb" "-fcoverage-compilation-dir=/proc/self/cwd" "-resource-dir" "/usr/local/google/home/dangyi/.cache/bazel/_bazel_dangyi/f2b9e39c6dd3dfd4d600a38e6ff65cce/external/fuchsia_clang/lib/clang/16.0.0" "-dependency-file" "bazel-out/x86_64-fastbuild/bin/src/qemu_edu/drivers/_objs/qemu_edu/edu_device.pic.d" "-MT" "bazel-out/x86_64-fastbuild/bin/src/qemu_edu/drivers/_objs/qemu_edu/edu_device.pic.o" "-sys-header-deps" "-iquote" "." "-iquote" "bazel-out/x86_64-fastbuild/bin" "-iquote" "external/fuchsia_sdk" "-iquote" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk" "-iquote" "external/bazel_tools" "-iquote" "bazel-out/x86_64-fastbuild/bin/external/bazel_tools" "-I" "bazel-out/x86_64-fastbuild/bin/src/qemu_edu/fidl/_virtual_includes/fuchsia.examples.qemuedu_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/zx/_virtual_includes/zx_llcpp_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/fidl_cpp_wire/_virtual_includes/fidl_cpp_wire" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/async/_virtual_includes/async" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/fit/_virtual_includes/fit" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/stdcompat/_virtual_includes/stdcompat" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/fit-promise/_virtual_includes/fit-promise" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/async-cpp/_virtual_includes/async-cpp" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/zx/_virtual_includes/zx" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/fidl/_virtual_includes/fidl" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/fidl_base/_virtual_includes/fidl_base" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/utf-utils/_virtual_includes/utf-utils" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/sync/_virtual_includes/sync" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/zxc/_virtual_includes/zxc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/fidl_cpp_v2/_virtual_includes/fidl_cpp_v2" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/fidl_cpp_base_v2/_virtual_includes/fidl_cpp_base_v2" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.device.fs/_virtual_includes/fuchsia.device.fs_llcpp_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.io/_virtual_includes/fuchsia.io_llcpp_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.unknown/_virtual_includes/fuchsia.unknown_llcpp_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.driver.compat/_virtual_includes/fuchsia.driver.compat_llcpp_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.hardware.pci/_virtual_includes/fuchsia.hardware.pci_llcpp_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/zx/_virtual_includes/zx_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/fidl_cpp/_virtual_includes/fidl_cpp" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/async-default/_virtual_includes/async-default" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/fidl_cpp_sync/_virtual_includes/fidl_cpp_sync" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/fidl_cpp_base/_virtual_includes/fidl_cpp_base" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/driver2_cpp/_virtual_includes/driver2_cpp" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/driver2-record/_virtual_includes/driver2-record" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/driver_runtime/_virtual_includes/driver_runtime" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/driver_runtime_cpp/_virtual_includes/driver_runtime_cpp" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/fdio/_virtual_includes/fdio" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/fidl_driver_transport/_virtual_includes/fidl_driver_transport" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/sys_component_cpp/_virtual_includes/sys_component_cpp" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/svc/_virtual_includes/svc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/trace-engine/_virtual_includes/trace-engine" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.io/_virtual_includes/fuchsia.io_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.unknown/_virtual_includes/fuchsia.unknown_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/syslog_structured_backend/_virtual_includes/syslog_structured_backend" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.component.decl/_virtual_includes/fuchsia.component.decl_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.data/_virtual_includes/fuchsia.data_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.url/_virtual_includes/fuchsia.url_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.driver.framework/_virtual_includes/fuchsia.driver.framework_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.component/_virtual_includes/fuchsia.component_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.process/_virtual_includes/fuchsia.process_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.ldsvc/_virtual_includes/fuchsia.ldsvc_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.component.runner/_virtual_includes/fuchsia.component.runner_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.diagnostics.types/_virtual_includes/fuchsia.diagnostics.types_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.mem/_virtual_includes/fuchsia.mem_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.logger/_virtual_includes/fuchsia.logger_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.diagnostics/_virtual_includes/fuchsia.diagnostics_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.component.decl/_virtual_includes/fuchsia.component.decl_llcpp_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.data/_virtual_includes/fuchsia.data_llcpp_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.url/_virtual_includes/fuchsia.url_llcpp_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.driver.framework/_virtual_includes/fuchsia.driver.framework_llcpp_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.component/_virtual_includes/fuchsia.component_llcpp_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.process/_virtual_includes/fuchsia.process_llcpp_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.ldsvc/_virtual_includes/fuchsia.ldsvc_llcpp_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.component.runner/_virtual_includes/fuchsia.component.runner_llcpp_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.diagnostics.types/_virtual_includes/fuchsia.diagnostics.types_llcpp_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.mem/_virtual_includes/fuchsia.mem_llcpp_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.logger/_virtual_includes/fuchsia.logger_llcpp_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/fidl/fuchsia.diagnostics/_virtual_includes/fuchsia.diagnostics_llcpp_cc" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/hwreg/_virtual_includes/hwreg" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/mmio/_virtual_includes/mmio" "-I" "bazel-out/x86_64-fastbuild/bin/external/fuchsia_sdk/pkg/mmio-ptr/_virtual_includes/mmio-ptr" "-isysroot" "external/fuchsia_clang/fuchsia_sysroot_x86_64" "-internal-isystem" "/usr/local/google/home/dangyi/.cache/bazel/_bazel_dangyi/f2b9e39c6dd3dfd4d600a38e6ff65cce/external/fuchsia_clang/bin/../include/x86_64-unknown-fuchsia/c++/v1" "-internal-isystem" "/usr/local/google/home/dangyi/.cache/bazel/_bazel_dangyi/f2b9e39c6dd3dfd4d600a38e6ff65cce/external/fuchsia_clang/bin/../include/c++/v1" "-internal-isystem" "/usr/local/google/home/dangyi/.cache/bazel/_bazel_dangyi/f2b9e39c6dd3dfd4d600a38e6ff65cce/external/fuchsia_clang/lib/clang/16.0.0/include" "-internal-externc-isystem" "external/fuchsia_clang/fuchsia_sysroot_x86_64/include" "-Wall" "-Werror" "-Wextra-semi" "-Wnewline-eof" "-std=c++17" "-fdeprecated-macro" "-fdebug-compilation-dir=/proc/self/cwd" "-ferror-limit" "19" "-fsanitize=safe-stack" "-fno-sanitize-memory-param-retval" "-stack-protector" "2" "-fgnuc-version=4.2.1" "-fcxx-exceptions" "-fexceptions" "-fcolor-diagnostics" "-faddrsig" "-D__GCC_HAVE_DWARF2_CFI_ASM=1" "-o" "bazel-out/x86_64-fastbuild/bin/src/qemu_edu/drivers/_objs/qemu_edu/edu_device.pic.o" "-x" "c++" "src/qemu_edu/drivers/edu_device.cc"

LLVM=${HOME}/llvm-sysroot
BIN=${LLVM}/build/bin
CC=${BIN}/clang

# The first arg is the source file, but all the comments will be removed in the
# reduction, including FileCheck comments, so just store the file somewhere and
# use that.
TEST_FILE="/tmp/foo.ll"

# It's nice to clean up, so we'll delete this this later, or since I put it in
# /tmp, you could reasonably ignore it...
OUT_NAME="/tmp/foo.o"

CMD=${CC} "-cc1" "-triple" "x86_64-unknown-fuchsia" "-emit-obj" "-mrelax-all" "--mrelax-relocations" "-disable-free" "-clear-ast-before-backend" "-disable-llvm-verifier" "-discard-value-names" "-main-file-name" "edu_device.cc" "-mrelocation-model" "pic" "-pic-level" "2" "-fhalf-no-semantic-interposition" "-mframe-pointer=all" "-ffp-contract=on" "-fno-rounding-math" "-mconstructor-aliases" "-funwind-tables=2" "-target-cpu" "x86-64" "-tune-cpu" "generic" "-mllvm" "-treat-scalable-fixed-error-as-warning" "-debug-info-kind=constructor" "-dwarf-version=5" "-debugger-tuning=gdb" "-fcoverage-compilation-dir=/proc/self/cwd" "-sys-header-deps" "-Wall" "-Werror" "-Wextra-semi" "-Wnewline-eof" "-std=c++17" "-fdeprecated-macro" "-fdebug-compilation-dir=/proc/self/cwd" "-ferror-limit" "19" "-fno-sanitize-memory-param-retval" "-stack-protector" "2" "-fgnuc-version=4.2.1" "-fcxx-exceptions" "-fexceptions" "-fcolor-diagnostics" "-faddrsig" "-D__GCC_HAVE_DWARF2_CFI_ASM=1" "-x" "ir" -o ${OUT_NAME} $1

${CMD}
ret1=$?
if [[ $ret1 -eq 1 ]]; then
    echo re = $ret1
    exit 1
fi

${BIN}/llvm-dwarfdump --name HandleIrq --show-children ${OUT_NAME} | ${BIN}/FileCheck $TEST_FILE
ret2=$?

# clean up the .o file
rm $OUT_NAME

if [[ $ret2 -eq 0  ]]; then
    echo val = $ret2
    exit 0
fi
exit 1

